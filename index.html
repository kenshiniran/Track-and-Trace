<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agentic Track & Trace Dashboard</title>
    <!-- Leaflet CSS for map in Shipment Details -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <script>
        // Global variables for Firebase configuration
        window.__app_id = 'demo-app-id';
        window.__firebase_config = {
            apiKey: "demo-api-key",
            authDomain: "demo-project.firebaseapp.com",
            projectId: "demo-project",
            storageBucket: "demo-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        };
        window.__initial_auth_token = null; // Will be set by your Firebase auth system
        // Email notifications via Google Apps Script Web App
        // Default recipient is used if a shipment has no contactEmail set.
        window.__email_webhook = 'https://script.google.com/macros/s/AKfycbyvsv2ra6xau5-uXUaADMv_YRa4It4rF_tGzj_hITzVuObaAeKPmkXA_La7-k67MrI/exec';
        window.__notify_email = 'kenshiniran@gmail.com';
    </script>
    <script>
      (function(){
        try{
          const isGitHubPages = location.hostname.endsWith('github.io');
          // Suppress noisy extension rejection error on GH Pages
          window.addEventListener('unhandledrejection', function(e){
            const msg = String(e && (e.reason?.message || e.reason || ''));
            if (isGitHubPages && msg.includes('A listener indicated an asynchronous response')) e.preventDefault();
          });
          window.addEventListener('error', function(e){
            const msg = String(e && (e.message || e.error?.message || ''));
            if (isGitHubPages && msg.includes('A listener indicated an asynchronous response')) e.preventDefault();
          });

          if (!isGitHubPages) return;

          const responders = [
            { match: u => u.includes('quickmap.dot.ca.gov/data/events.json'), respond: () => ({ type:'FeatureCollection', features:[] }) },
            { match: u => u.includes('router.project-osrm.org/route/v1/driving'), respond: () => ({ code:'Ok', routes:[{ duration:3600, distance:80000, legs:[] }], waypoints:[] }) },
            { match: u => u.includes('api.open-meteo.com/v1/forecast'), respond: (u) => { let lat=null,lon=null; try{const o=new URL(u,location.origin); lat=parseFloat(o.searchParams.get('latitude')); lon=parseFloat(o.searchParams.get('longitude'));}catch(_){} const inCA=(lat!==null&&lon!==null&&lat>=32&&lat<=42.5&&lon>=-125&&lon<=-113); return inCA?{hourly:{precipitation:[6],wind_speed_10m:[35]}}:{hourly:{precipitation:[0],wind_speed_10m:[5]}}; } },
            { match: u => u.includes('api.weather.gov/alerts'), respond: (u) => { let lat=null,lon=null; try{const o=new URL(u,location.origin); const p=o.searchParams.get('point'); if(p&&p.includes(',')){ const [a,b]=p.split(',').map(parseFloat); lat=a; lon=b; }}catch(_){} const inCA=(lat!==null&&lon!==null&&lat>=32&&lat<=42.5&&lon>=-125&&lon<=-113); if(inCA){ return { type:'FeatureCollection', features:[{ id:'mock-ca-1', properties:{ event:'Wind Advisory', severity:'Moderate', headline:'Gusty winds may impact travel', onset:new Date().toISOString(), ends:new Date(Date.now()+2*3600*1000).toISOString() }, geometry:{ type:'Point', coordinates:[lon,lat] } }] }; } return { type:'FeatureCollection', features:[{ id:'mock-generic-1', properties:{ event:'Statement', severity:'Minor', headline:'No active severe alerts', onset:new Date().toISOString(), ends:new Date(Date.now()+3600*1000).toISOString() }, geometry:{ type:'Point', coordinates:[-120,37] } }] }; } }
          ];
          function maybeMock(url){ for(const r of responders){ try{ if(url && r.match(url)) return r.respond(url);}catch(_){} } return null; }

          // fetch shim
          const origFetch = window.fetch ? window.fetch.bind(window) : null;
          if (origFetch) {
            window.fetch = async function(input, init){
              const url = (typeof input === 'string') ? input : (input && input.url);
              const mock = maybeMock(url || '');
              if (mock !== null) return new Response(JSON.stringify(mock), { status:200, headers:{ 'Content-Type':'application/json' } });
              return origFetch(input, init);
            };
          }

          // XHR shim
          if (window.XMLHttpRequest) {
            const origOpen = XMLHttpRequest.prototype.open;
            const origSend = XMLHttpRequest.prototype.send;
            XMLHttpRequest.prototype.open = function(method, url){ this.__qt_mock = maybeMock(url || ''); return origOpen.apply(this, arguments); };
            XMLHttpRequest.prototype.send = function(body){ if(this.__qt_mock!==null && this.__qt_mock!==undefined){ const self=this; const resp=JSON.stringify(this.__qt_mock); setTimeout(function(){ try{self.readyState=4;}catch(e){} try{self.status=200;}catch(e){} try{self.responseText=resp;}catch(e){} try{ if(typeof self.onreadystatechange==='function') self.onreadystatechange(); }catch(e){} try{ if(typeof self.onload==='function') self.onload(); }catch(e){} },0); return; } return origSend.apply(this, arguments); };
          }
        }catch(_){ }
      })();
    </script>
    <script type="module" crossorigin src="./assets/index-B34lNTCi.js?v=20251026-2137"></script>
    <link rel="stylesheet" crossorigin href="./assets/index-Co2FFXxf.css?v=20251026-2137">
  </head>
<body>
    <div id="root"></div>
    <!-- Leaflet JS -->
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin="anonymous">
    </script>
    <!-- Vite dev/prod entry -->
</body>
</html>
